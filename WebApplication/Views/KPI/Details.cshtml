@model IEnumerable<KPI>
@{
    ViewBag.Title = "Index";
    var KPI = ViewBag.KPI as KPI;
}

<h2>BẢNG PHÂN BỔ KPI NĂM HỌC 2019-2020</h2>

<ul class="breadcrumb">
@if (KPI != KPI.KP1)
{
    <li>@KPI.MucTieu</li>
    KPI = KPI != KPI.KP1 ? KPI.KP1 : null;
}
else
{
    <li>@KPI.MucTieu</li>
    KPI = null;
}
@while (KPI != null)
{
    <li>@Html.ActionLink(KPI.MucTieu, "Details", new { id = -KPI.id })</li>
    KPI = KPI != KPI.KP1 ? KPI.KP1 : null;
}
</ul>

<p>
    @Html.ActionLink("Create New", "Create", new { id = -(ViewBag.KPI as KPI).id })
</p>
<table class="table">
    <tr>
        <th>Mục tiêu</th>
        <th>Tỷ trọng</th>
        <th>Chỉ tiêu</th>
        <th>Đơn vị tính</th>
        <th>Owner</th>
        <th></th>
    </tr>
@foreach (var item in Model.OrderBy(kpi => kpi.MucTieu))
{
    <tr>
        <td>
            @Html.ActionLink(item.MucTieu, "Details", new { id = -item.id })
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.TyTrong)% (@item.KPIs.Count)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.ChiTieu)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.DonViTinh)
        </td>
        <td>
            @item.Email.Split('@')[0]
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id = -item.id }) |
            @Html.ActionLink("Delete", "Delete", new { id = item.id })
        </td>
    </tr>
}
    <tr>
        <td>Tổng cộng</td>
        <td>@Model.Sum(kpi => kpi.TyTrong)%</td>
    </tr>
</table>
